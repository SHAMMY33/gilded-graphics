<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>no27 • RIDERS' RESERVE</title>
  <meta name="description" content="Bold design + DTF printing. Apparel, logos, and graphics that actually hit." />
  <link rel="stylesheet" href="css/style.css?v=3" />
</head>
<body>
  <div class="bar">
    <span>DTF PRINT • DESIGN • FAST TURNAROUNDS</span>
    <span class="dot">•</span>
    <span>FREE LOCAL SHIPPING</span>
  </div>

  <header class="nav">
    <a class="brand" href="index.html">GILDED</a>

    <nav class="links">
      <a href="shop.html">Shop</a>
      <a href="work.html">Work</a>

  <!-- Cart icon -->
      <button class="iconbtn" id="openCartBtn" type="button" aria-label="Open cart">
        <img
          id="cartIcon"
          src="assets/images/shopping-bag-empty.png"
          data-empty="assets/images/shopping-bag-empty.png"
          data-full="assets/images/shopping-bag-full.png"
          alt=""
        />
      </button>
      
    </nav>
  </header>

<main class="wrap">
  <section class="pagehead">
    <h1>No. 27 - Rider's Reserve</h1>
    <p class="muted">COWBOYS NEVER DIE.</p>
  </section>

  <section class="grid-2" style="margin-top:14px; align-items:start;">
    <!-- LEFT: Gallery -->
    <div>
      <div class="p-card">
        <div class="p-img" style="aspect-ratio: 4 / 5; position:relative;">
          <button type="button" class="smallbtn" id="gPrev"
            style="position:absolute;left:10px;top:50%;transform:translateY(-50%);z-index:2;">
            ‹
          </button>

          <img
            id="mainImg"
            src="assets/images/products/no27/no27_001.jpg"
            alt="No. 27 - Rider's Reserve"
            style="width:100%;height:100%;object-fit:cover;display:block;"
          />

          <button type="button" class="smallbtn" id="gNext"
            style="position:absolute;right:10px;top:50%;transform:translateY(-50%);z-index:2;">
            ›
          </button>
        </div>
      </div>

      <!-- thumbnails (ONE thumbRow only) -->
        <div id="thumbRow"
          style="
            
            grid-auto-flow: column;
            grid-auto-columns: 64px;
            gap:8px;
            margin-top:12px;
            justify-content:center;
            overflow-x:auto;
            padding: 0 0 8px;
            scroll-snap-type:x mandatory;
          ">


  <button type="button" data-img="assets/images/products/no27/no27_001.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_001.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_002.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_002.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_003.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_003.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_004.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_004.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_005.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_005.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_006.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_006.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>
  
  <button type="button" data-img="assets/images/products/no27/no27_007.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_007.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>

  <button type="button" data-img="assets/images/products/no27/no27_008.jpg"
    style="width:64px;height:64px;border:1px solid #ffffff;border-radius:12px;background:#fff;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;">
    <img src="assets/images/products/no27/no27_008.jpg" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">
  </button>
</div>

    </div>

    <!-- RIGHT: Options -->
    <div class="card" data-sku="no27_riders_reserve" data-name="No. 27 - Rider's Reserve">
      <div class="row">
        <label for="size">Size</label>
        <select id="size">
          <option value="S">Small</option>
          <option value="M">Medium</option>
          <option value="L">Large</option>
          <option value="XL">Extra Large</option>
        </select>
      </div>

      <div class="row">
        <label for="color">Color</label>
        <select id="color">
          <option value="Toast">Toast</option>
          <option value="White">White</option>
          <option value="Natural">Natural</option>
          <option value="Forest">Forest</option>
        </select>
      </div>

      <div class="price" id="pPrice">$35.00</div>

      <div class="row">
        <label for="qty">Quantity</label>
        <input id="qty" type="number" min="1" value="1" />
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" id="addBtn" type="button">Add to Cart</button>
        <a class="smallbtn" href="shop.html">Back to Shop</a>
      </div>

      <p class="notice">Spirit of the West</p>
      <p class="notice">Smoke'em if you Gottem</p>
    </div>
  </section>
</main>

  <!-- Backdrop -->
  <div class="cart-backdrop" id="cartBackdrop" hidden></div>

  <!-- Cart Drawer -->
  <aside class="cart" id="cartDrawer" hidden>
    <div class="cart-top">
      <h2>Your Cart</h2>
      <button class="smallbtn" id="closeCartBtn" type="button">Close</button>
    </div>

    <div class="cart-items" id="cartItems"></div>

    <div class="cart-actions">
      <button class="btn full" id="checkoutBtn" type="button">Checkout</button>
      <button class="smallbtn" id="clearCartBtn" type="button">Clear cart</button>
    </div>

    <p class="notice">
      Add items on the Shop page. Cart persists across pages.
    </p>
  </aside>

  <!-- Cart storage -->
  <script src="assets/cart.js?v=4"></script>

  <!-- Shared product catalog (MUST exist) -->
  <script src="assets/products.js?v=1"></script>

  <script>

// --- Product page: Add to Cart wiring ---
(() => {
  const addBtn = byId("addBtn");
  if (!addBtn) return;

  const card = addBtn.closest(".card");
  const sku = card?.dataset?.sku;

  addBtn.addEventListener("click", () => {
    if (!window.Cart) return toast("Cart failed to load");
    if (!sku) return toast("Missing product SKU on page");

    const qty = Math.max(1, parseInt(byId("qty")?.value || "1", 10) || 1);
    const size = byId("size")?.value || "";
    const color = byId("color")?.value || "";

    window.Cart.add(sku, qty, { size, color });

    updateCartIcon();
    window.dispatchEvent(new Event("gilded:cart-changed"));
    toast(`Added: ${qty} • ${size} • ${color}`);
  });
})();

    // --- Product page: simple gallery (arrows + thumbnails) ---
(() => {
  const mainImg = byId("mainImg");
  const thumbs = Array.from(document.querySelectorAll("#thumbRow [data-img]"));
  const prev = byId("gPrev");
  const next = byId("gNext");

  if (!mainImg || !thumbs.length) return;

  const images = thumbs.map(b => b.getAttribute("data-img")).filter(Boolean);
  let i = Math.max(0, images.indexOf(mainImg.getAttribute("src")));

  function setIndex(nextIndex){
    i = (nextIndex + images.length) % images.length;
    mainImg.src = images[i];

    // optional: simple active border
    thumbs.forEach((b, idx) => {
      b.style.outline = (idx === i) ? "" : "none";
    });
  }

  thumbs.forEach((b, idx) => {
    b.addEventListener("click", () => setIndex(idx));
  });

  prev?.addEventListener("click", () => setIndex(i - 1));
  next?.addEventListener("click", () => setIndex(i + 1));

  // init highlight
  setIndex(i);
})();

    
    function toast(msg) {
      const t = document.createElement("div");
      t.textContent = msg;
      t.style.position = "fixed";
      t.style.right = "18px";
      t.style.bottom = "18px";
      t.style.padding = "10px 12px";
      t.style.border = "1px solid rgba(0,0,0,.15)";
      t.style.background = "#fff";
      t.style.fontWeight = "800";
      t.style.zIndex = "9999";
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1400);
    }

    function byId(id){ return document.getElementById(id); }
    function money(n){ return "$" + Number(n || 0).toFixed(2); }

    function getCatalog(){
      return Array.isArray(window.PRODUCTS) ? window.PRODUCTS : [];
    }

    function updateCartIcon() {
      const icon = byId("cartIcon");
      if (!icon || !window.Cart) return;

      const n = window.Cart.count();
      icon.src = n > 0 ? icon.dataset.full : icon.dataset.empty;
    }

    function renderProducts() {
      const grid = byId("productGrid");
      if (!grid) return;

      const PRODUCTS = getCatalog();

      if (!PRODUCTS.length) {
        grid.innerHTML = "<p class='muted'>No products yet. Add them in assets/products.js</p>";
        return;
      }

      grid.innerHTML = PRODUCTS.map(p => `
        <article class="p-card">
          <div class="p-img">
            ${p.image ? `<img src="${p.image}" alt="${p.name}" onerror="this.remove()">` : ``}

            <!-- Add-to-cart bag (BOTTOM-RGHT) -->
            <button class="add-bag" type="button" data-sku="${p.sku}" aria-label="Add ${p.name} to cart">
              <img src="assets/images/shopping-bag-full.png" alt="" aria-hidden="true">
            </button>
          </div>

          <div class="p-body">
            <div class="p-top">
              <h3>${p.name}</h3>
              ${p.tag ? `<span class="tag">${p.tag}</span>` : ``}
            </div>

            <div class="price">${money(p.price)}</div>

            <p>${p.desc || ""}</p>
          </div>
        </article>
      `).join("");

      // wire bag buttons
      grid.querySelectorAll("button.add-bag[data-sku]").forEach(btn => {
        btn.addEventListener("click", () => {
          if (!window.Cart) {
            toast("Cart failed to load");
            return;
          }
          window.Cart.add(btn.getAttribute("data-sku"), 1);
          updateCartIcon();
          toast("Added to cart");
          window.dispatchEvent(new Event("gilded:cart-changed"));
        });
      });
    }

    function renderCart() {
      const itemsEl = byId("cartItems");
      if (!itemsEl || !window.Cart) return;

      const items = window.Cart.read();
      const catalog = getCatalog();

      itemsEl.innerHTML = "";

      if (!items.length) {
        itemsEl.innerHTML = "<p class='muted'>Your cart is empty.</p>";
        return;
      }

      items.forEach(item => {
        const product = catalog.find(p => p.sku === item.sku);

        const row = document.createElement("div");
        row.className = "cart-item";

        row.innerHTML = `
          <div class="cart-left">
            <span class="cart-title">${product ? product.name : item.sku}</span>
            <span class="cart-price">
              ${product ? money(product.price) : ""}
              ${item.meta?.size || item.meta?.color ? ` • ${item.meta.size || ""}${item.meta.color ? " / " + item.meta.color : ""}` : ""}
              • Qty
            </span>
          </div>

          <div class="cart-right">
            <input class="qty" type="number" min="1" value="${Number(item.qty) || 1}" />
            <button class="smallbtn" type="button" aria-label="Remove">✕</button>
          </div>
        `;

        const qtyInput = row.querySelector("input.qty");
        const removeBtn = row.querySelector("button[aria-label='Remove']");

          qtyInput.addEventListener("change", () => {
            const next = parseInt(qtyInput.value, 10);
            window.Cart.setQty(item.key || item.sku, Number.isFinite(next) ? next : (Number(item.qty) || 1));
            updateCartIcon();
            renderCart();
            window.dispatchEvent(new Event("gilded:cart-changed"));
          });
          
          removeBtn.addEventListener("click", () => {
            window.Cart.remove(item.key || item.sku);
            updateCartIcon();
            renderCart();
            window.dispatchEvent(new Event("gilded:cart-changed"));
          });


        itemsEl.appendChild(row);
      });
    }

    // Drawer controls
    const drawer = byId("cartDrawer");
    const backdrop = byId("cartBackdrop");

    function openCart(){
      drawer.hidden = false;
      backdrop.hidden = false;
      drawer.classList.add("is-open");
      updateCartIcon();
      renderCart();
    }

    function closeCart(){
      drawer.classList.remove("is-open");
      setTimeout(() => {
        drawer.hidden = true;
        backdrop.hidden = true;
      }, 180);
    }

    // Init
    renderProducts();
    updateCartIcon();

    byId("openCartBtn").addEventListener("click", openCart);
    byId("closeCartBtn").addEventListener("click", closeCart);
    backdrop.addEventListener("click", closeCart);

    byId("clearCartBtn").addEventListener("click", () => {
      window.Cart.clear();
      updateCartIcon();
      renderCart();
      window.dispatchEvent(new Event("gilded:cart-changed"));
    });

      // ... keep everything you already have ABOVE this ...

  byId("checkoutBtn")?.addEventListener("click", async () => {
    if (!window.Cart) return;

    const items = window.Cart.read(); // [{sku, qty}]
    if (!items.length) {
      toast("Cart is empty");
      return;
    }

    try {
      const res = await fetch("https://gilded-checkout.vercel.app/api/checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ items })
      });

      if (!res.ok) {
        const txt = await res.text();
        console.error("Checkout error:", txt);
        toast("Checkout failed — see console");
        return;
      }

      const data = await res.json();
      if (!data.url) {
        console.error("Missing url:", data);
        toast("Checkout failed — missing URL");
        return;
      }

      // send them to Stripe Checkout
      window.location.href = data.url;

    } catch (err) {
      console.error(err);
      toast("Checkout error — network blocked?");
    }
  });

    // optional cross-page updates
    window.addEventListener("gilded:cart-changed", () => {
      updateCartIcon();
      if (drawer && !drawer.hidden) renderCart();
    });
  </script>
</body>
</html>
